<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PantherWatch API</title>
  <link rel="stylesheet" href="/index.css" />
</head>
<body>
  <div class="wrap">
    <header>
      <h1>PantherWatch API</h1>
      <div class="muted">Base URL: <code>https://api.pantherwatch.app</code></div>
      <p class="muted small">This page lists available endpoints, request parameters and example responses. Public endpoints can be called directly. Protected endpoints require a Supabase JWT in the Authorization header.</p>
    </header>

    <section class="card">
      <h2>Authentication</h2>
      <p class="small">Protected endpoints require:</p>
      <pre><code>Authorization: Bearer &lt;your_supabase_jwt&gt;</code></pre>
      <p class="muted small">A 401 is returned if the header is missing/invalid. CORS and OPTIONS requests are allowed.</p>
    </section>

    <section class="card">
      <h2>Courses (Public)</h2>

      <div class="endpoint">
        <div><span class="method GET">GET</span> <code>/api/courses/terms</code> <span class="chip public">public</span></div>
        <p class="small muted">Returns a list of available terms.</p>
        <div class="small">Response (200):</div>
        <pre><code>[
  {
    "code": "202508",
    "description": "Fall 2025"
  }
]</code></pre>
        <div class="small">curl:</div>
        <pre><code>curl -s https://api.pantherwatch.app/api/courses/terms</code></pre>
      </div>

      <div class="endpoint">
        <div><span class="method GET">GET</span> <code>/api/courses/search</code> <span class="chip public">public</span></div>
        <p class="small muted">Searches courses. Supply query parameters below. Returns a paged result with data array of course sections.</p>
        <div class="small">Query params:</div>
        <ul class="small">
          <li><code>txt_subject</code> (e.g., <code>CS</code>)</li>
          <li><code>txt_courseNumber</code> (e.g., <code>1301</code>)</li>
          <li><code>txt_term</code> (term code, see terms endpoint)</li>
          <li><code>txt_level</code> (optional)</li>
        </ul>
        <div class="small">Response (200):</div>
        <pre><code>{
  "success": true,
  "totalCount": 1,
  "data": [
    {
      "termDesc": "Fall 2025",
      "courseReferenceNumber": "12345",
      "courseNumber": "1301",
      "subject": "CS",
      "subjectDescription": "Computer Science",
      "courseTitle": "Intro to Programming",
      "seatsAvailable": 5,
      "faculty": [ { "displayName": "Prof. Ada" } ],
      "meetingsFaculty": [ { "meetingTime": { "monday": true, "beginTime": "09:00" }} ]
    }
  ],
  "pageOffset": 1,
  "pageMaxSize": 10
}</code></pre>
        <div class="small">curl:</div>
        <pre><code>curl -s "https://api.pantherwatch.app/api/courses/search?txt_subject=CS&txt_courseNumber=1301&txt_term=202508"</code></pre>
      </div>
    </section>

    <section class="card">
      <h2>Watched Classes (Protected)</h2>
      <p class="small muted">All endpoints below require <code>Authorization: Bearer &lt;token&gt;</code>.</p>

      <div class="endpoint">
        <div><span class="method GET">GET</span> <code>/api/watched-classes</code> <span class="chip protected">protected</span></div>
        <p class="small muted">Returns your current watch list.</p>
        <div class="small">Response:</div>
        <pre><code>{
  "success": true,
  "data": [
    {
      "id": 1,
      "crn": "12345",
      "term": "202508",
      "courseTitle": "Intro to Programming",
      "courseNumber": "1301",
      "subject": "CS",
      "instructor": "Prof. Ada",
      "createdAt": "2025-08-30T12:34:56"
    }
  ],
  "count": 1
}</code></pre>
        <div class="small">curl:</div>
        <pre><code>curl -s -H "Authorization: Bearer $TOKEN" https://api.pantherwatch.app/api/watched-classes</code></pre>
      </div>

      <div class="endpoint">
        <div><span class="method POST">POST</span> <code>/api/watched-classes</code> <span class="chip protected">protected</span></div>
        <p class="small muted">Add a class to your watch list.</p>
        <div class="small">Body (JSON):</div>
        <pre><code>{
  "crn": "12345",
  "term": "202508",
  "courseTitle": "Intro to Programming",
  "courseNumber": "1301",
  "subject": "CS",
  "instructor": "Prof. Ada"
}</code></pre>
        <div class="small">Response:</div>
        <pre><code>{ "success": true, "message": "Class added to watch list", "data": { ... } }</code></pre>
        <div class="small">curl:</div>
        <pre><code>curl -s -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"crn":"12345","term":"202508","courseTitle":"Intro to Programming","courseNumber":"1301","subject":"CS","instructor":"Prof. Ada"}' \
  https://api.pantherwatch.app/api/watched-classes</code></pre>
      </div>

      <div class="endpoint">
        <div><span class="method DELETE">DELETE</span> <code>/api/watched-classes?crn=...&amp;term=...</code> <span class="chip protected">protected</span></div>
        <p class="small muted">Remove a class from your watch list.</p>
        <div class="small">Response:</div>
        <pre><code>{ "success": true, "message": "Class removed from watch list" }</code></pre>
        <div class="small">curl:</div>
        <pre><code>curl -s -X DELETE -H "Authorization: Bearer $TOKEN" \
  "https://api.pantherwatch.app/api/watched-classes?crn=12345&term=202508"</code></pre>
      </div>

      <div class="endpoint">
        <div><span class="method GET">GET</span> <code>/api/watched-classes/check?crn=...&amp;term=...</code> <span class="chip protected">protected</span></div>
        <p class="small muted">Check if you are watching a specific class.</p>
        <div class="small">Response:</div>
        <pre><code>{ "success": true, "isWatching": true }</code></pre>
      </div>

      <div class="endpoint">
        <div><span class="method GET">GET</span> <code>/api/watched-classes/count</code> <span class="chip protected">protected</span></div>
        <p class="small muted">Get the number of classes you are watching.</p>
        <div class="small">Response:</div>
        <pre><code>{ "success": true, "count": 3 }</code></pre>
      </div>

      <div class="endpoint">
        <div><span class="method GET">GET</span> <code>/api/watched-classes/full-details</code> <span class="chip protected">protected</span></div>
        <p class="small muted">Returns full course details (CourseData objects) for your watch list.</p>
        <div class="small">Response (example fields):</div>
        <pre><code>{
  "success": true,
  "data": [
    {
      "termDesc": "Fall 2025",
      "courseReferenceNumber": "12345",
      "subject": "CS",
      "courseNumber": "1301",
      "courseTitle": "Intro to Programming",
      "seatsAvailable": 5
    }
  ],
  "count": 1
}</code></pre>
      </div>
    </section>

    <section class="card">
      <h2>Notes</h2>
      <ul class="small">
        <li>All responses are JSON. Errors include { "success": false, "message": "..." } for watched-classes endpoints.</li>
        <li>CORS allows localhost dev origins and pantherwatch.app where configured; browser clients should include credentials only where needed.</li>
        <li>Terms and Course search proxy the university schedule service via the backend.</li>
      </ul>
    </section>

    <footer class="muted small">Â© PantherWatch API</footer>
  </div>
</body>
</html>